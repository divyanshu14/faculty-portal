DROP DATABASE faculty_portal;

CREATE DATABASE faculty_portal;

\c faculty_portal

CREATE TABLE person(
	pid SERIAL PRIMARY KEY,
	name VARCHAR (255) NOT NULL,
	inst_doj DATE NOT NULL DEFAULT CURRENT_DATE
);

CREATE TYPE staff_type_choices AS ENUM(
	'fac',
	'cc_fac'
);

CREATE TABLE staff(
	staff_email VARCHAR (255) NOT NULL PRIMARY KEY,
	staff_pid INTEGER REFERENCES person(pid) ON DELETE CASCADE NOT NULL,
	staff_type staff_type_choices NOT NULL,
	UNIQUE (staff_pid, staff_type)
);

CREATE TABLE faculty(
	fac_staff_email VARCHAR (255) REFERENCES staff(staff_email) ON DELETE CASCADE NOT NULL PRIMARY KEY
);

CREATE TABLE department(
	dep_name VARCHAR (255) NOT NULL PRIMARY KEY,
	hod_email VARCHAR (255) REFERENCES faculty(fac_staff_email) ON DELETE RESTRICT NOT NULL,
	hod_from_date DATE NOT NULL DEFAULT CURRENT_DATE,
	hod_to_date DATE NOT NULL
);

ALTER TABLE faculty ADD fac_dep_name VARCHAR (255) REFERENCES department(dep_name) NOT NULL;

CREATE TYPE cc_fac_post_choices AS ENUM(
	'adfa',
	'dfa',
	'dir'
);

CREATE TABLE cc_faculty(
	cc_fac_post cc_fac_post_choices NOT NULL PRIMARY KEY,
	cc_fac_staff_email VARCHAR (255) REFERENCES staff(staff_email) ON DELETE RESTRICT NOT NULL UNIQUE,
	from_date DATE NOT NULL DEFAULT CURRENT_DATE,
	to_date DATE NOT NULL
);

CREATE TYPE possession_choices AS ENUM(
	'fac',
	'hod',
	'adfa',
	'dfa',
	'dir'
);

CREATE TABLE fac_leave_app_path(
	curr_state_no SERIAL PRIMARY KEY,
	curr_possession possession_choices NOT NULL,
	next_possession possession_choices NOT NULL
);

CREATE TABLE hod_deans_leave_app_path(
	curr_state_no SERIAL PRIMARY KEY,
	curr_possession possession_choices NOT NULL,
	next_possession possession_choices NOT NULL
);

CREATE TABLE leave_app(
	requested_by_pid INTEGER REFERENCES person(pid) ON DELETE CASCADE NOT NULL PRIMARY KEY,
	no_of_days INTEGER NOT NULL,
	borrow_from_next_year BOOLEAN NOT NULL,
	curr_message TEXT,
	curr_possession VARCHAR (255) REFERENCES staff(staff_email) NOT NULL,
	next_possession VARCHAR (255) REFERENCES staff(staff_email)
);

CREATE TABLE rem_leaves(
	pid INTEGER REFERENCES person(pid) ON DELETE CASCADE NOT NULL,
	year INTEGER NOT NULL,
	rem_leaves_curr_year INTEGER NOT NULL DEFAULT 20,
	PRIMARY KEY(pid,year)
);
